/**
ttLights is a chrome extension and javascript bookmarklet that adds
customizable webkit animated "lighting rigs" for turntable.fm

Copyright (c) 2012 Steven (Egest√©) Regester

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
of the Software, and to permit persons to whom the Software is furnished to do
so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/window.tt=window.tt||{},tt.lights={model:{},views:{},templates:{},author:"4e55144e4fe7d02a3f2c486a"},tt.lights.build=new Date(1348166986e3),tt.lights.css="QC13ZWJraXQta2V5ZnJhbWVzIGZhbjkwIHsgIDAlICAgeyAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlWCg0NWRlZyk7ICB9ICAxMDAlIHsgICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZVgoOTBkZWcpOyAgfX1ALXdlYmtpdC1rZXlmcmFtZXMgcGVuZHVsdW0geyAgMCUgeyAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlWig0NWRlZyk7ICB9ICAxMDAlICAgeyAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlWigtNDVkZWcpOyAgfX1ALXdlYmtpdC1rZXlmcmFtZXMgbGlnaHQtY2lyY2xlIHsgIDAlIHsgICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZVooMGRlZykgcm90YXRlWCgwZGVnKTsgICAgei1pbmRleDogLTE7ICAgIGhlaWdodDogNTAlOyAgfSAgMjUlIHsgICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZVooNDVkZWcpIHJvdGF0ZVgoMjJkZWcpOyAgICB6LWluZGV4OiAwOyAgfSAgNTAlIHsgICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZVooMGRlZykgcm90YXRlWCg0NWRlZyk7ICAgIHotaW5kZXg6IDE7ICAgIGhlaWdodDogMTAwJTsgIH0gIDc1JSAgIHsgICAgLXdlYmtpdC10cmFuc2Zvcm06IHJvdGF0ZVooLTQ1ZGVnKSByb3RhdGVYKDIyZGVnKTsgICAgei1pbmRleDogMDsgIH0gIDEwMCUgeyAgICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlWigwZGVnKSByb3RhdGVYKDBkZWcpOyAgICB6LWluZGV4OiAtMTsgICAgaGVpZ2h0OiA1MCU7ICB9fS8qIERpYWxvZyBjb21wb25lbnRzICovLnR0TGlnaHRzLm1vZGFsIGFiYnIueCB7ICB3aWR0aDogMTJweDsgIGhlaWdodDogMTJweDsgIGJvcmRlci1yYWRpdXM6IDNweDsgIGJhY2tncm91bmQtcG9zaXRpb246IDAgMTJweDsgIGJhY2tncm91bmQtaW1hZ2U6dXJsKGh0dHBzOi8vczMuYW1hem9uYXdzLmNvbS9zdGF0aWMudHVybnRhYmxlLmZtL2ltYWdlcy9wbGF5bGlzdC94X2J1dHRvbl9zcHJpdGUucG5nKTt9LnR0TGlnaHRzLm1vZGFsIGFiYnIueDpob3ZlciB7ICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDA7fS50dExpZ2h0cy5tb2RhbCBwIHsgIHRleHQtYWxpZ246IGNlbnRlcjt9LnR0TGlnaHRzLm1vZGFsIGZvcm0geyAgdGV4dC1hbGlnbjogY2VudGVyO30vKiBXZWxjb21lIGRpYWxvZyAqLy50dExpZ2h0cy53ZWxjb21lIGltZyB7ICBkaXNwbGF5OiBibG9jazsgIG1hcmdpbjogMTBweCBhdXRvO30udHRMaWdodHMud2VsY29tZSBwLC50dExpZ2h0cy53ZWxjb21lIHVsIHsgIG1hcmdpbjogMTVweCBpbmhlcml0O30udHRMaWdodHMud2VsY29tZSB1bCBsaSB7ICBtYXJnaW4tbGVmdDogMjBweDt9LyogU2V0dGluZ3MgZGlhbG9nICovLnR0TGlnaHRzLnNldHRpbmdzIGFiYnIueCB7ICBtYXJnaW46IDNweDsgIGZsb2F0OiByaWdodDt9LnR0TGlnaHRzLnNldHRpbmdzIHVsIGxpIHsgIHBhZGRpbmc6IDVweDsgIGJhY2tncm91bmQ6ICM5OTk7ICBtYXJnaW4tYm90dG9tOiA1cHg7ICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7ICBib3JkZXI6IDFweCBzb2xpZCAjMzMzO30udHRMaWdodHMuc2V0dGluZ3MgdWwgbGkuYWRkLWxpZ2h0IHsgIHRleHQtYWxpZ246IGNlbnRlcjt9LnR0TGlnaHRzLnNldHRpbmdzIHVsIGxpLmFkZC1saWdodCwudHRMaWdodHMuc2V0dGluZ3MgdWwgbGkgLmxpZ2h0LW5hbWUgeyAgY3Vyc29yOiBwb2ludGVyOyAgZm9udC13ZWlnaHQ6IGJvbGQ7fS50dExpZ2h0cy5zZXR0aW5ncyB1bCBsaS5hZGQtbGlnaHQ6aG92ZXIgeyAgYmFja2dyb3VuZC1jb2xvcjogI2NjYzt9LnR0TGlnaHRzLnNldHRpbmdzIHVsIGxpIC5kZXRhaWwgeyAgZGlzcGxheTogbm9uZTt9LnR0TGlnaHRzLnNldHRpbmdzIHVsIGxpLm9wZW4gLmRldGFpbCB7ICBkaXNwbGF5OiBibG9jazt9Lm92ZXJsYXkgaW5wdXRbdHlwZT1maWxlXSB7ICBwYWRkaW5nOiAwICFpbXBvcnRhbnQ7ICBjb2xvcjogd2hpdGUgIWltcG9ydGFudDsgIGJvcmRlcjogbm9uZSAhaW1wb3J0YW50OyAgbWFyZ2luOiAxMHB4IDVweCAhaW1wb3J0YW50OyAgYmFja2dyb3VuZDogbm9uZSAhaW1wb3J0YW50O30udHRMaWdodHMuc3RhZ2UgeyAgd2lkdGg6IDEwMCU7ICBoZWlnaHQ6IDEwMCU7ICB6LWluZGV4OiAxMDAxOyAgb3ZlcmZsb3c6IGhpZGRlbjsgIHBvc2l0aW9uOiBhYnNvbHV0ZTsgIHBvaW50ZXItZXZlbnRzOiBub25lOyAgLXdlYmtpdC1wZXJzcGVjdGl2ZTogNDAwcHg7ICAtd2Via2l0LXBlcnNwZWN0aXZlLW9yaWdpbjogNTAlIDE1JTt9LnR0TGlnaHRzLnN0YWdlID4gZGl2LC50dExpZ2h0cy5zdGFnZSA+IGRpdiA+IGRpdiB7ICBwb3NpdGlvbjogYWJzb2x1dGU7ICAtd2Via2l0LXRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7fS50dExpZ2h0cy5zdGFnZSAubGlnaHQgeyAgd2lkdGg6IDI1cHg7ICBtYXJnaW4tbGVmdDogLTEycHg7ICAtd2Via2l0LXRyYW5zZm9ybS1vcmlnaW46IDUwJSAxNXB4OyAgLXdlYmtpdC1hbmltYXRpb246IGxpZ2h0LWNpcmNsZSAycyBpbmZpbml0ZSBlYXNlLWluLW91dDt9LnR0TGlnaHRzLnN0YWdlIC5saWdodCAuYm9keSwudHRMaWdodHMuc3RhZ2UgLmxpZ2h0IC5zb3VyY2UgeyAgbGVmdDogLTFweDsgIHdpZHRoOiAxMDAlOyAgaGVpZ2h0OiAyNXB4OyAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7fS50dExpZ2h0cy5zdGFnZSAubGlnaHQgLmJvZHkgeyAgdG9wOiAwOyAgYm9yZGVyLXJhZGl1czogMTNweCAxM3B4IDAgMDsgIGJhY2tncm91bmQ6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KGxlZnQsICM5MDAgMCUsICNjMDAgNTAlLCAjOTAwIDEwMCUpO30udHRMaWdodHMuc3RhZ2UgLmxpZ2h0IC5zb3VyY2UgeyAgdG9wOiAyN3B4OyAgYmFja2dyb3VuZDogI2ZmZjsgIGJvcmRlci1yYWRpdXM6IDEzcHg7ICAtd2Via2l0LXRyYW5zZm9ybTogcm90YXRlWCg5MGRlZykgdHJhbnNsYXRlWigxNHB4KTt9LnR0TGlnaHRzLnN0YWdlIC5saWdodCAuYmVhbSB7ICB0b3A6IDEzcHg7ICBsZWZ0OiAtMzhweDsgIG9wYWNpdHk6IDAuMjsgIHdpZHRoOiAxMDBweDsgIGhlaWdodDogMTAwJTsgIGJvcmRlci1yYWRpdXM6IDUwJTsgIGJhY2tncm91bmQ6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KGxlZnQsIHJnYmEoMjU1LDI1NSwyNTUsMCkgMCUsIHJnYmEoMjU1LDI1NSwyNTUsMSkgMzUlLCByZ2JhKDI1NSwyNTUsMjU1LDEpIDY1JSwgcmdiYSgyNTUsMjU1LDI1NSwwKSAxMDAlKTt9LnR0TGlnaHRzLnN0YWdlIC5sYXNlciB7ICB3aWR0aDogNzBweDsgIGhlaWdodDogMzBweDt9LnR0TGlnaHRzLnN0YWdlIC5sYXNlciAuYm9keSB7ICB3aWR0aDogMTAwJTsgIGhlaWdodDogMTAwJTsgIGJvcmRlci1yYWRpdXM6IDVweDsgIGJhY2tncm91bmQ6IC13ZWJraXQtbGluZWFyLWdyYWRpZW50KHRvcCwgIzdmN2Y3ZiAwJSwgIzIwMjAyMCAxNSUsICMyMDIwMjAgODUlLCAjN2Y3ZjdmIDEwMCUpO30udHRMaWdodHMuc3RhZ2UgLmxhc2VyIC5zb3VyY2UgeyAgd2lkdGg6IDdweDsgIGhlaWdodDogMTVweDsgIG1hcmdpbjogNnB4IGF1dG87ICBwb3NpdGlvbjogcmVsYXRpdmU7ICBib3JkZXItcmFkaXVzOiAxMHB4OyAgYm9yZGVyOiAxcHggc29saWQgYmxhY2s7ICBiYWNrZ3JvdW5kOiAtd2Via2l0LXJhZGlhbC1ncmFkaWVudChjZW50ZXIsIGVsbGlwc2UgY292ZXIsICByZ2JhKDI1NSwyNTUsMjU1LDEpIDAlLCByZ2JhKDI1NSwyNTUsMjU1LDApIDEwMCUpO30udHRMaWdodHMuc3RhZ2UgLmxhc2VyIC5iZWFtLC50dExpZ2h0cy5zdGFnZSAubGFzZXIgLmJlYW0gPiBkaXYgeyAgLXdlYmtpdC10cmFuc2Zvcm0tb3JpZ2luOiAxNXB4IDA7fS50dExpZ2h0cy5zdGFnZSAubGFzZXIgLmJlYW0geyAgdG9wOiAxNXB4OyAgbGVmdDogNTAlOyAgd2lkdGg6IDMwcHg7ICBvcGFjaXR5OiAwLjY7ICBtYXJnaW4tbGVmdDogLTE1cHg7ICAtd2Via2l0LWFuaW1hdGlvbjogZmFuOTAgMC41cyBpbmZpbml0ZSBsaW5lYXIgYWx0ZXJuYXRlO30udHRMaWdodHMuc3RhZ2UgLmxhc2VyIC5iZWFtID4gZGl2IHsgIGhlaWdodDogOTk5cHg7ICBib3JkZXItcmFkaXVzOiA1MCU7ICBiYWNrZ3JvdW5kOiAtd2Via2l0LWxpbmVhci1ncmFkaWVudChsZWZ0LCAgcmdiYSgwLDI1NSwwLDApIDAlLHJnYmEoMCwyNTUsMCwwLjIpIDQwJSxyZ2JhKDI1NSwyNTUsMjU1LDEpIDUwJSxyZ2JhKDAsMjU1LDAsMC4yKSA2MCUscmdiYSgwLDI1NSwwLDApIDEwMCUpO30=",tt.lights.templates.laser_settings='<div class="light-name">  <abbr class="x"></abbr>  Laser <%= laser.collection.models.indexOf(laser) %></div><div class="detail">  <div class="position section">    <div>Position:</div>    <input name="top" value="<%= laser.get(\'top\') %>" placeholder="Top" />    <input name="left" value="<%= laser.get(\'left\') %>" placeholder="Left" />    <input name="right" value="<%= laser.get(\'right\') %>" placeholder="Right" />    <input name="bottom" value="<%= laser.get(\'bottom\') %>" placeholder="Bottom" />  </div>  <div class="color section">    <div>Color:</div>    <input name="color" value="<%= _.rgbToHex(laser.get(\'color\')) %>" placeholder="Color" />  </div>  <div class="beams section">    <div>Beams:</div>    <input name="beams" value="<%= laser.get(\'beams\') %>" placeholder="Beams" />  </div></div>',tt.lights.templates.light_settings='<div class="light-name">  <abbr class="x"></abbr>  Light <%= light.collection.models.indexOf(light) %></div><div class="detail">  <div class="position section">    <div>Position:</div>    <input name="top" value="<%= light.get(\'top\') %>" placeholder="Top" />    <input name="left" value="<%= light.get(\'left\') %>" placeholder="Left" />    <input name="right" value="<%= light.get(\'right\') %>" placeholder="Right" />    <input name="bottom" value="<%= light.get(\'bottom\') %>" placeholder="Bottom" />  </div>  <div class="color section">    <div>Color:</div>    <input name="color" value="<%= _.rgbToHex(light.get(\'color\')) %>" placeholder="Color" />  </div></div>',tt.lights.templates.settings='<div class="close-x"></div><div class="content-scroller" style="max-height:500px;">  <div class="content">    <h2 class="title">ttLights</h2>    <div class="title">Release: <%= tt.lights.build.toUTCString() %></div>    <h3>Lights</h3>    <ul class="lights"></ul>    <h3>Lasers</h3>    <ul class="lasers"></ul>    <h3>Import &amp; Export</h3>    <input type="file" name="import" />    <div style="text-align:center;">      <button class="import">Import Settings</button>      <button class="export">Export Settings</button>    </div>    <form action="https://www.paypal.com/cgi-bin/webscr" method="post">      <input type="hidden" name="cmd" value="_s-xclick">      <input type="hidden" name="hosted_button_id" value="NWHAFR3G9KV6J">      <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">      <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">    </form>  </div></div>',tt.lights.templates.welcome='<div class="close-x"></div><div class="content-scroller" style="max-height:500px;">  <div class="content">    <img src="https://raw.github.com/egeste/ttLights/master/extension/icons/icon_128.png" />    <h2 class="title">Welcome to ttLights!</h2>    <p>ttLights aims to bring the "digital club experience" to a new level on turntable.fm with customizable lighting rigs that you can share with your friends. So enjoy! Explore! And share your awesome lighting setups! Get started by checking out the ttlights settings in Settings &gt; ttLights.<p>    <h3>Features</h3>    <ul>      <li>Animated spotlight modules</li>      <li>Animated laser modules</li>      <li>Customizable layouts</li>      <li>Customizable colors</li>      <li>Layout export</li>      <li>Layout import</li>    </ul>    <h3>Future Features</h3>    <ul>      <li>Flourish</li>      <li>Color picker</li>      <li>WebGL animations</li>      <li>More light modules</li>      <li>Customizable animations</li>      <li>Drag &amp; drop lighting modules</li>      <li>BPM tap button to sync animations</li>      <li>Lighting effect output filters (strobe, etc)</li>      <li>More ideas welcome!</li>    </ul>    <h3>Found a bug? Want a feature?</h3>    <p>It\'s impossible to keep track of every bug and feature request unless they\'re centralized. If you found a bug or would like to request a feature, please <a href=\'https://github.com/egeste/ttLights/issues\' target=\'_blank\'>submit your comments here.</a></p>    <p>If you\'re a developer and want to contribute, please feel free to <a href=\'https://github.com/egeste/ttLights\' target=\'_blank\'>fork me on github</a> and send as many pull requests as your heart desires.</p>  </div></div>',function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.unshift,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return new q(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.3.3";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=x.toArray(e).reverse();return r&&!i&&(t=x.bind(t,r)),i?x.reduce(s,t,n,r):x.reduce(s,t)},x.find=x.detect=function(e,t,n){var r;return N(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){var r=[];return e==null?r:(T(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},x.every=x.all=function(e,t,r){var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var N=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.include=x.contains=function(e,t){var n=!1;return e==null?n:y&&e.indexOf===y?e.indexOf(t)!=-1:(n=N(e,function(e){return e===t}),n)},x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=Math.floor(Math.random()*++n),r[n-1]=r[t],r[t]=e}),r},x.sortBy=function(e,t,n){var r=C(e,t);return x.pluck(x.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")};var C=function(e,t){return x.isFunction(t)?t:function(e){return e[t]}},k=function(e,t,n){var r={},i=C(e,t);return T(e,function(e,t){var s=i(e,t);n(r,s,e)}),r};x.groupBy=function(e,t){return k(e,t,function(e,t,n){(e[t]||(e[t]=[])).push(n)})},x.countBy=function(e,t){return k(e,t,function(e,t,n){e[t]||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n){n||(n=x.identity);var r=n(t),i=0,s=e.length;while(i<s){var o=i+s>>1;n(e[o])<r?i=o+1:s=o}return i},x.toArray=function(e){return e?x.isArray(e)||x.isArguments(e)?u.call(e):x.isFunction(e.toArray)?e.toArray():x.values(e):[]},x.size=function(e){return x.isArray(e)?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,function(e){return!!e})};var L=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):L(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return L(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n){var r=n?x.map(e,n):e,i=[];return x.reduce(r,function(n,r,s){if(t?x.last(n)!==r||!n.length:!x.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},x.union=function(){return x.uniq(L(arguments,!0,[]))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=L(u.call(arguments,1),!0,[]);return x.filter(e,function(e){return!x.include(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.zipObject=function(e,t){var n={};for(var r=0,i=e.length;r<i;r++)n[e[r]]=t[r];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;if(y&&e.indexOf===y)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t){if(e==null)return-1;if(b&&e.lastIndexOf===b)return e.lastIndexOf(t);var n=e.length;while(n--)if(e[n]===t)return n;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var A=function(){};x.bind=function(t,n){var r,i;if(t.bind===S&&S)return S.apply(t,u.call(arguments,1));if(!x.isFunction(t))throw new TypeError;return i=u.call(arguments,2),r=function(){if(this instanceof r){A.prototype=t.prototype;var e=new A,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length==0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o,u,a=x.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:(s=!0,u=e.apply(n,r)),a(),u}},x.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)},u=n&&!r;clearTimeout(r),r=setTimeout(o,t),u&&e.apply(i,s)}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},x.wrap=function(e,t){return function(){var n=[e].concat(u.call(arguments,0));return t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){return x.map(e,x.identity)},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=x.flatten(u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t=x.extend({},e),n=x.flatten(u.call(arguments,1));return T(n,function(e){delete t[e]}),t},x.defaults=function(e){return T(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&x.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&x.isFunction(t.isEqual))return t.isEqual(e);var r=f.call(e);if(r!=f.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&O(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(x.has(e,u)){s++;if(!(o=x.has(t,u)&&O(e[u],t[u],n)))break}if(o){for(u in t)if(x.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o};x.isEqual=function(e,t){return O(e,t,[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType==1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),x.isFinite=function(e){return x.isNumber(e)&&isFinite(e)},x.isNaN=function(e){return e!==e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},_=/[&<>"'\/]/g;x.escape=function(e){return(""+e).replace(_,function(e){return M[e]})},x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){U(t,x[t]=e[t])})};var D=0;x.uniqueId=function(e){var t=D++;return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/.^/,H={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var B in H)H[H[B]]=B;var j=/\\|'|\r|\n|\t|\u2028|\u2029/g,F=/\\(\\|'|r|n|t|u2028|u2029)/g,I=function(e){return e.replace(F,function(e,t){return H[t]})};x.template=function(e,t,n){n=x.defaults(n||{},x.templateSettings);var r="__p+='"+e.replace(j,function(e){return"\\"+H[e]}).replace(n.escape||P,function(e,t){return"'+\n((__t=("+I(t)+"))==null?'':_.escape(__t))+\n'"}).replace(n.interpolate||P,function(e,t){return"'+\n((__t=("+I(t)+"))==null?'':__t)+\n'"}).replace(n.evaluate||P,function(e,t){return"';\n"+I(t)+"\n__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,x);var s=function(e){return i.call(this,e,x)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},x.chain=function(e){return x(e).chain()};var q=function(e){this._wrapped=e};x.prototype=q.prototype;var R=function(e,t){return t?x(e).chain():e},U=function(e,t){q.prototype[e]=function(){var e=u.call(arguments);return a.call(e,this._wrapped),R(t.apply(x,e),this._chain)}};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];q.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],R(n,this._chain)}}),T(["concat","join","slice"],function(e){var t=r[e];q.prototype[e]=function(){return R(t.apply(this._wrapped,arguments),this._chain)}}),q.prototype.chain=function(){return this._chain=!0,this},q.prototype.value=function(){return this._wrapped}}.call(this),function(){var e=this,t=e.Backbone,n=Array.prototype.splice,r;typeof exports!="undefined"?r=exports:r=e.Backbone={},r.VERSION="0.9.2";var i=e._;!i&&typeof require!="undefined"&&(i=require("underscore")),r.$=e.jQuery||e.Zepto||e.ender,r.noConflict=function(){return e.Backbone=t,this},r.emulateHTTP=!1,r.emulateJSON=!1;var s=/\s+/,o=r.Events={on:function(e,t,n){var r,i,o;if(!t)return this;e=e.split(s),r=this._callbacks||(this._callbacks={});while(i=e.shift())o=r[i]||(r[i]=[]),o.push(t,n);return this},off:function(e,t,n){var r,o,u,a;if(!(o=this._callbacks))return this;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(s):i.keys(o);while(r=e.shift()){if(!(u=o[r])||!t&&!n){delete o[r];continue}for(a=u.length-2;a>=0;a-=2)t&&u[a]!==t||n&&u[a+1]!==n||u.splice(a,2)}return this},trigger:function(e){var t,n,r,i,o,u,a,f;if(!(n=this._callbacks))return this;f=[],e=e.split(s);for(i=1,o=arguments.length;i<o;i++)f[i-1]=arguments[i];while(t=e.shift()){if(a=n.all)a=a.slice();if(r=n[t])r=r.slice();if(r)for(i=0,o=r.length;i<o;i+=2)r[i].apply(r[i+1]||this,f);if(a){u=[t].concat(f);for(i=0,o=a.length;i<o;i+=2)a[i].apply(a[i+1]||this,u)}}return this}};o.bind=o.on,o.unbind=o.off;var u=r.Model=function(e,t){var n;e||(e={}),t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(e=this.parse(e));if(n=T(this,"defaults"))e=i.extend({},n,e);this.attributes={},this._escapedAttributes={},this.cid=i.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=i.clone(this.attributes),this.initialize.apply(this,arguments)};i.extend(u.prototype,o,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return r.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=i.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,s,o;i.isObject(e)||e==null?(r=e,n=t):(r={},r[e]=t),n||(n={});if(!r)return this;r instanceof u&&(r=r.attributes);if(n.unset)for(s in r)r[s]=void 0;if(!this._validate(r,n))return!1;this.idAttribute in r&&(this.id=r[this.idAttribute]);var a=n.changes={},f=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in r){o=r[s];if(!i.isEqual(f[s],o)||n.unset&&i.has(f,s))delete l[s],(n.silent?this._silent:a)[s]=!0;n.unset?delete f[s]:f[s]=o,!i.isEqual(c[s],o)||i.has(f,s)!==i.has(c,s)?(this.changed[s]=o,n.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return n.silent||this.change(n),this},unset:function(e,t){return t=i.extend({},t,{unset:!0}),this.set(e,null,t)},clear:function(e){return e=i.extend({},e,{unset:!0}),this.set(i.clone(this.attributes),e)},fetch:function(e){e=e?i.clone(e):{};var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},e.error=r.wrapError(e.error,t,e),this.sync("read",this,e)},save:function(e,t,n){var s,o,u;i.isObject(e)||e==null?(s=e,n=t):(s={},s[e]=t),n=n?i.clone(n):{};if(n.wait){if(!this._validate(s,n))return!1;o=i.clone(this.attributes)}var a=i.extend({},n,{silent:!0});if(s&&!this.set(s,n.wait?a:n))return!1;if(!s&&!this.isValid())return!1;var f=this,l=n.success;n.success=function(e,t,r){u=!0;var o=f.parse(e,r);n.wait&&(o=i.extend(s||{},o));if(!f.set(o,n))return!1;l&&l(f,e,n),f.trigger("sync",f,e,n)},n.error=r.wrapError(n.error,f,n);var c=this.sync(this.isNew()?"create":"update",this,n);return!u&&n.wait&&(this.clear(a),this.set(o,a)),c},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,s=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(r){(e.wait||t.isNew())&&s(),n&&n(t,r,e),t.isNew()||t.trigger("sync",t,r,e)};if(this.isNew())return e.success(),!1;e.error=r.wrapError(e.error,t,e);var o=this.sync("delete",this,e);return e.wait||s(),o},url:function(){var e=T(this,"urlRoot")||T(this.collection,"url")||N();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var r=i.extend({},e.changes,this._silent);this._silent={};for(var n in r)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;while(!i.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var n in this.changed){if(this._pending[n]||this._silent[n])continue;delete this.changed[n]}this._previousAttributes=i.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return e==null?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var s in e){if(i.isEqual(r[s],t=e[s]))continue;(n||(n={}))[s]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return i.clone(this._previousAttributes)},isValid:function(){return!this.validate||!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var a=r.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&(t.parse&&(e=this.parse(e)),this.reset(e,{silent:!0,parse:t.parse}))};i.extend(a.prototype,o,{model:u,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return r.sync.apply(this,arguments)},add:function(e,t){var r,s,o,u,a,f,l={},c={},h=[];t||(t={}),e=i.isArray(e)?e.slice():[e];for(r=0,o=e.length;r<o;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)h[r]=e.splice(h[r],1)[0];for(r=0,o=e.length;r<o;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=o,s=t.at!=null?t.at:this.models.length,n.apply(this.models,[s,0].concat(e));if(t.merge)for(r=0,o=h.length;r<o;r++)(u=this._byId[h[r].id])&&u.set(h[r],t);this.comparator&&t.at==null&&this.sort({silent:!0});if(t.silent)return this;for(r=0,o=this.models.length;r<o;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var n,r,s,o;t||(t={}),e=i.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){o=this.getByCid(e[n])||this.get(e[n]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,i.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return i.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=i.bind(this.comparator,this);return this.comparator.length===1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return i.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?i.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r,e),t.trigger("sync",t,r,e)},e.error=r.wrapError(e.error,t,e),this.sync("read",this,e)},create:function(e,t){var n=this;t=t?i.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return i(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel
:function(e,t){if(e instanceof u)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(n.attributes,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var f=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];i.each(f,function(e){a.prototype[e]=function(){return i[e].apply(i,[this.models].concat(i.toArray(arguments)))}});var l=r.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},c=/:\w+/g,h=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;i.extend(l.prototype,o,{initialize:function(){},route:function(e,t,n){return r.history||(r.history=new d),i.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),r.history.route(e,i.bind(function(i){var s=this._extractParameters(e,i);n&&n.apply(this,s),this.trigger.apply(this,["route:"+t].concat(s)),r.history.trigger("route",this,t,s)},this)),this},navigate:function(e,t){r.history.navigate(e,t)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(p,"\\$&").replace(c,"([^/]+)").replace(h,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var d=r.History=function(t){this.handlers=[],i.bindAll(this,"checkUrl"),this.location=t&&t.location||e.location,this.history=t&&t.history||e.history},v=/^[#\/]/,m=/msie [\w.]+/,g=/\/$/;d.started=!1,i.extend(d.prototype,o,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.options.root.replace(g,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return decodeURIComponent(e.replace(v,""))},start:function(e){if(d.started)throw new Error("Backbone.history has already been started");d.started=!0,this.options=i.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,s=m.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);g.test(this.options.root)||(this.options.root+="/"),s&&this._wantsHashChange&&(this.iframe=r.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=this.location,u=o.pathname.replace(/[^/]$/,"$&/")===this.options.root&&!o.search;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.options.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(v,""),this.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),d.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=i.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!d.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(v,"");if(this.fragment===n)return;this.fragment=n;var r=(n.indexOf(this.options.root)!==0?this.options.root:"")+n;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,r);else{if(!this._wantsHashChange)return this.location.assign(r);this._updateHash(this.location,n,t.replace),this.iframe&&n!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.href.replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var y=r.View=function(e){this.cid=i.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName"];i.extend(y.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},dispose:function(){return this.undelegateEvents(),this.model&&this.model.off(null,null,this),this.collection&&this.collection.off(null,null,this),this},remove:function(){return this.dispose(),this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r.$(i).attr(t),n!=null&&r.$(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r.$?e:r.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=T(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];i.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(b),s=r[1],o=r[2];n=i.bind(n,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,n):this.$el.delegate(o,s,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=i.extend({},this.options,e));for(var t=0,n=w.length;t<n;t++){var r=w[t];e[r]&&(this[r]=e[r])}this.options=e},_ensureElement:function(){if(!this.el){var e=i.extend({},T(this,"attributes"));this.id&&(e.id=T(this,"id")),this.className&&(e["class"]=T(this,"className")),this.setElement(this.make(T(this,"tagName"),e),!1)}else this.setElement(this.el,!1)}});var E={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};r.sync=function(e,t,n){var s=E[e];n||(n={});var o={type:s,dataType:"json"};return n.url||(o.url=T(t,"url")||N()),!n.data&&t&&(e==="create"||e==="update")&&(o.contentType="application/json",o.data=JSON.stringify(t)),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&(s==="PUT"||s==="DELETE")&&(r.emulateJSON&&(o.data._method=s),o.type="POST",o.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s)}),o.type!=="GET"&&!r.emulateJSON&&(o.processData=!1),r.ajax(i.extend(o,n))},r.ajax=function(){return r.$.ajax.apply(r.$,arguments)},r.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var S=function(){},x=function(e,t){var n=this,r;return e&&e.hasOwnProperty("constructor")?r=e.constructor:r=function(){n.apply(this,arguments)},i.extend(r,n),S.prototype=n.prototype,r.prototype=new S,e&&i.extend(r.prototype,e),t&&i.extend(r,t),r.prototype.constructor=r,r.__super__=n.prototype,r};u.extend=a.extend=l.extend=y.extend=x;var T=function(e,t){return!e||!e[t]?null:i.isFunction(e[t])?e[t]():e[t]},N=function(){throw new Error('A "url" property or function must be specified')}}.call(this),function(){var e={room:null,getRoom:function(){for(var t in turntable){var n=turntable[t];if(typeof n!="object"||n===null)continue;if(typeof n.setupRoom!="undefined")return e.room=n,n}return!1},manager:null,getManager:function(){for(var t in e.getRoom()){var n=e.room[t];if(typeof n!="object"||n===null)continue;if(typeof n.blackswan!="undefined")return e.manager=n,n}return!1},api:null,getApi:function(){var t=/ Preparing message /i;for(var n in turntable){var r=turntable[n];if(typeof r!="function")continue;if(t.test(Function.prototype.toString.apply(r)))return e.api=r,r}return!1}};typeof module=="object"&&exports in module&&(module.exports=e),typeof window!="undefined"&&(window.ttObjects=e)}(),function(){var e=function(e){var t=e.toString(16);return t.length==1?"0"+t:t};_.mixin({random:function(e,t,n){var r=Math.random()*t+e;return n?Math.round(r):r},randomColor:function(){return[_.random(0,255,1),_.random(0,255,1),_.random(0,255,1)]},adjustColor:function(e,t,n){return n=n||0,t=t/100||0,_(e).map(function(e){return t&&(e=Math.round(e+e*t)),n&&(e=Math.max(e,n)),Math.min(e,255)})},rgbToHex:function(t){return"#"+e(t[0])+e(t[1])+e(t[2])},hexToRGB:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return[parseInt(t[1],16)||0,parseInt(t[2],16)||0,parseInt(t[3],16)||0]},cssPosition:function(e){var t={};return _(["top","right","bottom","left"]).each(function(n){e[n]&&(t[n]=e[n])}),t}})}(),tt.lights.views.Laser=Backbone.View.extend({className:"ttLights laser",initialize:function(){this.model.on("change",this.update,this).on("destroy",this.remove,this).on("change:beams",this.render,this)},render:function(){this.$el.empty().append($('<div class="body"/>')).append($('<div class="source"/>'));for(var e=0;e<this.model.get("beams");e++)this.$el.append($('<div class="beam"><div/></div>'));return this.update()},update:function(){var e=this.model.get("angle"),t=_.extend(_.cssPosition(this.model.attributes),{"-webkit-transform":"rotateY("+e+"deg)"});this.$el.css(t);var n=this.$(".beam"),r=this.model.color(),i=this.model.get("speed"),s=this.model.get("delay"),o=this.model.get("spread"),u=o/n.length,a=e>0?u*-1:0;return n.each(function(e,t){var f=$(t),l=f.css("-webkit-animation-name"),c=u*e*-1+o/2+a,h=i/n.length*e*-1+s;f.css({"-webkit-animation-name":"initial","-webkit-animation-delay":h+"s"}).children().css({background:r,"-webkit-transform":"rotate("+c+"deg)"}),_.defer(function(){f.css("-webkit-animation-name",l)})}),this}}),tt.lights.views.Light=Backbone.View.extend({className:"ttLights light",initialize:function(){this.model.on("change",this.update,this).on("destroy",this.remove,this)},render:function(){return this.$el.empty().append($('<div class="beam"/>')).append($('<div class="source"/>')).append($('<div class="body"/>')),this.update()},update:function(){var e=_.extend(_.cssPosition(this.model.attributes),{"-webkit-animation-delay":this.model.get("delay")*-1+"s"});return this.$el.css(e),this.$(".beam").css("background",this.model.color()),this.$(".source").css("background",this.model.sourceColor()),this},restartAnimation:function(){var e=this.$el,t=e.css("-webkit-animation-name");return e.css("-webkit-animation-name","initial"),_.defer(function(){e.css("-webkit-animation-name",t)}),this}}),function(){var e=Backbone.View.extend({tagName:"li",events:{"click .x":"destroy","click .light-name":"open","keyup input":"_valueChanged"},render:function(){return this.$el.html(this.template(this.model)),this},open:function(){this.$el.toggleClass("open")},destroy:function(){this.model.destroy()},_valueChanged:function(e){var t=$(e.target),n=t.val(),r=t.attr("name");r==="color"&&(n=_.hexToRGB(n)),this.model.set(r,n)}}),t=Backbone.View.extend({events:{"click .add-light":"_addLight"},initialize:function(){this.collection.on("add remove",this.render,this)},render:function(){return this.$el.empty(),this.collection.each(function(e){(new this.options.ItemView({model:e})).render().$el.appendTo(this.$el)},this),this.$el.append($('<li class="add-light">+</li>')),this},_addLight:function(){this.collection.add(new this.collection.model)}});tt.lights.views.Settings=Backbone.View.extend({className:"settingsOverlay modal ttLights settings",template:_(tt.lights.templates.settings).template(null,{variable:"settings"}),events:{"click .close-x":"close","click .export":"_export","click .import":"_import"},initialize:function(){this.model=tt.lights.app.settings},render:function(){return this.$el.html(this.template()),(new t({el:this.$(".lights"),collection:tt.lights.app.settings.get("lights"),ItemView:e.extend({template:_(tt.lights.templates.light_settings).template(null,{variable:"light"})})})).render(),(new t({el:this.$(".lasers"),collection:tt.lights.app.settings.get("lasers"),ItemView:e.extend({template:_(tt.lights.templates.laser_settings).template(null,{variable:"laser"})})})).render(),this},open:function(){return util.showOverlay(this.render().$el),this},close:function(){this.model.save(),util.hideOverlay()},_export:function(){window.location.href="data:application/octet-stream;charset=utf-8,"+JSON.stringify(this.model)},_import:function(){var e=this.model,t=new FileReader,n=this.$("input[name=import]")[0].files[0];t.onload=function(){try{var t=JSON.parse(this.result)}catch(n){console.error(n)}e.set(e.parse(t)),tt.lights.app.destroySubViews().createSubViews().renderSubViews()},t.readAsText(n,"utf-8")}})}(),tt.lights.views.Stage=Backbone.View.extend({className:"ttLights stage",initialize:function(){this.collection.on("add",this.add,this).on("reset",this.render,this)},render:function(){return this.$el.empty(),this.collection.each(this.add,this),this},add:function(e){(new this.options.LightView({model:e})).render().$el.appendTo(this.$el)}}),tt.lights.views.Welcome=Backbone.View.extend({className:"settingsOverlay modal ttLights welcome",template:_(tt.lights.templates.welcome).template(null,{variable:"settings"}),events:{"click .close-x":"close"},render:function(){return this.$el.html(this.template()),this},open:function(){return this.model.get("welcome")&&util.showOverlay(this.render().$el),this},close:function(){this.model.save("welcome",!1),util.hideOverlay()}}),tt.lights.model.Laser=Backbone.Model.extend({defaults:{top:undefined,left:undefined,right:undefined,bottom:undefined,angle:0,beams:5,delay:0,speed:.5,spread:90,color:[0,255,0],animation:"fan90"},color:function(){var e=this.get("color").join(",");return"-webkit-linear-gradient(left, rgba("+e+",0) 0%, rgba("+e+",0.2) 40%, rgba(255,255,255,1) 50%, rgba("+e+",0.2) 60%, rgba("+e+",0) 100%)"}}),tt.lights.model.Lasers=Backbone.Collection.extend({model:tt.lights.model.Laser}),tt.lights.model.Light=Backbone.Model.extend({defaults:{top:undefined,left:undefined,right:undefined,bottom:undefined,delay:0,speed:.5,color:[255,255,255],animation:"light-circle"},color:function(){var e=this.attributes.color.join(","),t=_.adjustColor(this.attributes.color,85,150).join(",");return"-webkit-linear-gradient(left, rgba("+e+",0) 0%,rgba("+t+",1) 35%,rgba("+t+",1) 65%,rgba("+e+",0) 100%)"},sourceColor:function(){var e=this.attributes.color.join(",");return"-webkit-radial-gradient(center, ellipse cover, rgba(255,255,255,1) 35%,rgba("+e+",1) 100%)"}}),tt.lights.model.Lights=Backbone.Collection.extend({model:tt.lights.model.Light}),function(){var e="tt.lights.settings";tt.lights.model.Settings=Backbone.Model.extend({defaults:function(){return{welcome:!0,lights:new tt.lights.model.Lights([{left:"20%",color:[255,0,0]},{left:"40%",delay:.3,color:[0,255,0]},{left:"60%",delay:.6,color:[0,0,255]},{left:"80%",delay:.9,color:[255,0,255]}]),lasers:new tt.lights.model.Lasers([{top:"110px",left:"5px",angle:45,color:[0,255,0]},{top:"110px",right:"5px",angle:-45,delay:.25,color:[255,0,255]}])}},initialize:function(){this.fetch()},parse:function(e){return e.lights&&this.get("lights").reset(e.lights)&&delete e.lights,e.lasers&&this.get("lasers").reset(e.lasers)&&delete e.lasers,e},sync:function(t,n,r){if(t==="read"){try{var i=JSON.parse($.cookie(e))}catch(s){console.error(s)}return i?r.success(i):!1}if(t==="create"){var i=$.cookie(e,JSON.stringify(this),{json:!0});return i?r.success(this.toJSON()):!1}if(t==="delete")return $.cookie(e,null),!0},toJSON:function(){var e=_.clone(this.attributes);return e.lights&&(e.lights=e.lights.toJSON()),e.lasers&&(e.lasers=e.lasers.toJSON()),e}})}(),function(){var e=function(){var e=$.Deferred(),t=function(){if(turntable&&ttObjects.getApi())return e.resolve();setTimeout(t,500)};return t(),e.promise()},t=Backbone.View.extend({tagName:"link",className:"ttLights stylesheet",attributes:{rel:"stylesheet",type:"text/css",href:"data:text/css;base64,"+tt.lights.css}}),n=Backbone.View.extend({className:"ttLights menuItem",events:{click:function(){(new tt.lights.views.Settings).open()}},render:function(){return this.$el.text("ttLights"),this}});tt.lights.app=new(Backbone.View.extend({initialize:function(){_.bindAll(this,"render"),this.settings=new tt.lights.model.Settings,this.createSubViews(),$.when(e()).then(this.render)},createSubViews:function(){return this.welcome=new tt.lights.views.Welcome({model:this.settings}),this.lights=new tt.lights.views.Stage({LightView:tt.lights.views.Light,collection:this.settings.get("lights")}),this.lasers=new tt.lights.views.Stage({LightView:tt.lights.views.Laser,collection:this.settings.get("lasers")}),this},render:function(){return $(document.head).append((new t).$el),$("#menuh .menuItem:last").before((new n).render().$el),this.renderSubViews(),this},renderSubViews:function(){this.welcome.open();var e=$("div#floor-div").parent();return this.lights.render().$el.prependTo(e),this.lasers.render().$el.prependTo(e),this},destroySubViews:function(){return this.lights.remove(),this.lasers.remove(),this},destroy:function(){this.destroySubViews(),$(".ttLights").remove(),this.remove(),delete tt.lights}}))}();